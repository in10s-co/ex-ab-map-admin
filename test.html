<html>
<head>
    <meta charset="UTF-8">
    <title>지원전에 역량-경험map test 생성 페이지</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #F5F6FA;
        }

        h1 {
            text-align: center;
            color: #7165E3;
            margin: 20px;
        }

        .container {
            width: 80%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .segment {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px;
        }

        .segment label {
            display: inline-block;
            margin: 10px;
            color: #8B80F8;
        }

        .segment input[type="radio"] {
            display: none;
        }

        .segment input[type="radio"] + label {
            position: relative;
            padding: 10px 20px;
            border: 2px solid #E4DFFF;
            border-radius: 20px;
            cursor: pointer;
        }

        .segment input[type="radio"]:checked + label {
            background-color: #8B80F8;
            color: white;
        }

        .segment input[type="radio"]:checked + label::after {
            content: "";
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: white;
        }

        .button {
            display: inline-block;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background-color: #7165E3;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        .button:hover {
            opacity: 0.8;
        }

        .button:active {
            transform: scale(0.95);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .table th, .table td {
            padding: 10px;
            border: 1px solid #E4DFFF;
            text-align: left;
        }

        .table th {
            background-color: #8B80F8;
            color: white;
        }

        .table tr:nth-child(even) {
            background-color: #E4DFFF;
        }

        .table tr:hover {
            background-color: #7165E3;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 10;
        }

        .modal-content {
            position: relative;
            width: 80%;
            max-width: 800px;
            margin: 50px auto;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
            max-height: 80%;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 50%;
            background-color: #7165E3;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .modal-close:hover {
            opacity: 0.8;
        }

        .modal-close:active {
            transform: scale(0.95);
        }

        .modal-title {
            text-align: center;
            color: #7165E3;
            margin: 10px;
        }

        .modal-subtitle {
            color: #8B80F8;
            margin: 10px;
        }

        .keyword-list {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            margin: 10px;
        }

        .keyword {
            display: inline-block;
            padding: 5px 10px;
            border: 2px solid #E4DFFF;
            border-radius: 10px;
            margin: 5px;
            color: #8B80F8;
            cursor: pointer;
        }

        .keyword.selected {
            background-color: #8B80F8;
            color: white;
        }

        .icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: none;
            border-radius: 50%;
            background-color: #7165E3;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        .icon:hover {
            opacity: 0.8;
        }

        .icon:active {
            transform: scale(0.95);
        }

        .tree {
            margin: 10px;
            padding-left: 20px;
        }

        .tree ul {
            list-style: none;
        }

        .tree li {
            margin: 10px;
        }

        .tree li::before {
            content: "";
            position: absolute;
            left: -10px;
            top: 50%;
            width: 10px;
            height: 2px;
            background-color: #E4DFFF;
        }

        .tree li::after {
            content: "";
            position: absolute;
            left: -10px;
            top: 50%;
            width: 2px;
            height: 100%;
            background-color: #E4DFFF;
        }

        .tree li:last-child::after {
            height: 50%;
        }

        .tree li:first-child::after {
            height: 50%;
            top: 0;
        }

        .tree li span {
            display: inline-block;
            padding: 5px 10px;
            border: 2px solid #E4DFFF;
            border-radius: 10px;
            margin: 5px;
            color: #8B80F8;
            cursor: pointer;
        }

        .tree li span.selected {
            background-color: #8B80F8;
            color: white;
        }

        .form {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px;
        }

        .form label {
            display: inline-block;
            margin: 10px;
            color: #8B80F8;
        }

        .form input[type="radio"] {
            display: none;
        }

        .form input[type="radio"] + label {
            position: relative;
            padding: 10px 20px;
            border: 2px solid #E4DFFF;
            border-radius: 20px;
            cursor: pointer;
        }

        .form input[type="radio"]:checked + label {
            background-color: #8B80F8;
            color: white;
        }

        .form input[type="radio"]:checked + label::after {
            content: "";
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: white;
        }

        .form input[type="text"] {
            display: inline-block;
            padding: 10px;
            border: 2px solid #E4DFFF;
            border-radius: 20px;
            margin: 10px;
            color: #8B80F8;
        }

        .form input[type="text"]:focus {
            outline: none;
            border-color: #7165E3;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>지원전에 역량-경험map test 생성 페이지</h1>
    <div class="container">
        <div class="segment">
            <label>채용공고의 segment를 선택하세요.</label>
            <input type="radio" name="segment" id="segment1" value="1">
            <label for="segment1">IT/인터넷</label>
            <input type="radio" name="segment" id="segment2" value="2">
                        <label for="segment2">제조/화학</label>
            <input type="radio" name="segment" id="segment3" value="3">
            <label for="segment3">금융/보험</label>
            <input type="radio" name="segment" id="segment4" value="4">
            <label for="segment4">서비스/유통</label>
            <input type="radio" name="segment" id="segment5" value="5">
            <label for="segment5">의료/제약</label>
            <input type="radio" name="segment" id="segment6" value="6">
            <label for="segment6">교육/연구</label>
            <input type="radio" name="segment" id="segment7" value="7">
            <label for="segment7">공공/복지</label>
        </div>
        <div class="segment">
            <button class="button" id="search">조회</button>
        </div>
        <table class="table" id="job-list">
            <thead>
                <tr>
                    <th>채용공고 제목</th>
                    <th>기업명</th>
                    <th>역량map test 작성 여부</th>
                </tr>
            </thead>
            <tbody>
                <!-- 채용공고 목록이 여기에 동적으로 생성됩니다. -->
            </tbody>
        </table>
    </div>
    <div class="modal" id="job-modal">
        <div class="modal-content">
            <button class="modal-close" id="close">×</button>
            <h2 class="modal-title" id="job-title">채용공고 제목</h2>
            <h3 class="modal-subtitle">우대조건</h3>
            <p id="job-preference">우대조건 내용</p>
            <div class="keyword-list" id="preference-keywords">
                <!-- 우대조건 키워드가 여기에 동적으로 생성됩니다. -->
            </div>
            <h3 class="modal-subtitle">지원자격</h3>
            <p id="job-qualification">지원자격 내용</p>
            <div class="keyword-list" id="qualification-keywords">
                <!-- 지원자격 키워드가 여기에 동적으로 생성됩니다. -->
            </div>
            <table class="table" id="question-list">
                <thead>
                    <tr>
                        <th>예상 질문</th>
                        <th>필수</th>
                        <th>선택</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 예상 질문 목록이 여기에 동적으로 생성됩니다. -->
                </tbody>
            </table>
            <div class="tree" id="question-tree">
                <!-- 트리구조의 질문이 여기에 동적으로 생성됩니다. -->
            </div>
            <div class="form" id="question-form">
                <!-- 질문 생성 폼이 여기에 동적으로 생성됩니다. -->
            </div>
            <div class="segment">
                <button class="button" id="save">저장하기</button>
            </div>
        </div>
    </div>
    <script>
        // 채용공고의 segment를 선택하고 조회 버튼을 클릭하면 채용공고 목록을 가져오는 함수
        function getJobList() {
            // segment 값을 가져온다.
            var segment = $("input[name='segment']:checked").val();
            // segment 값이 없으면 alert를 띄운다.
            if (!segment) {
                alert("채용공고의 segment를 선택하세요.");
                return;
            }
            // segment 값을 backend api에 get 방식으로 전달해서 채용공고 목록을 받는다.
            $.get("/api/job-list?segment=" + segment, function(data) {
                // 채용공고 목록을 table에 동적으로 생성한다.
                var html = "";
                for (var i = 0; i < data.length; i++) {
                    var job = data[i];
                    html += "<tr data-id='" + job.id + "'>";
                    html += "<td>" + job.title + "</td>";
                    html += "<td>" + job.company + "</td>";
                    html += "<td><input type='checkbox' disabled " + (job.test ? "checked" : "") + "></td>";
                    html += "</tr>";
                }
                $("#job-list tbody").html(html);
            });
        }

        // 채용공고를 선택하면 채용공고의 상세 정보와 예상 질문 목록을 가져오는 함수
        function getJobDetail() {
            // 채용공고의 id 값을 가져온다.
            var id = $(this).data("id");
            // id 값을 backend api에 get 방식으로 전달해서 채용공고의 상세 정보를 받는다.
            $.get("/api/job-detail?id=" + id, function(data) {
                // 채용공고의 상세 정보를 modal에 동적으로 표시한다.
                $("#job-title").text(data.title);
                $("#job-preference").text(data.preference);
                $("#job-qualification").text(data.qualification);
                // 채용공고의 우대조건과 지원자격을 backend api에 get 방식으로 전달해서 키워드 목록을 받는다.
                $.get("/api/keyword-list?preference=" + data.preference + "&qualification=" + data.qualification, function(data) {
                    // 키워드 목록을 modal에 동적으로 생성한다.
                    var preferenceHtml = "";
                    var qualificationHtml = "";
                    for (var i = 0; i < data.preference.length; i++) {
                        var keyword = data.preference[i];
                        preferenceHtml += "<span class='keyword' data-keyword='" + keyword + "'>" + keyword + "</span>";
                    }
                    for (var i = 0; i < data.qualification.length; i++) {
                        var keyword = data.qualification[i];
                        qualificationHtml += "<span class='keyword' data-keyword='" + keyword + "'>" + keyword + "</span>";
                    }
                    $("#preference-keywords").html(preferenceHtml);
                    $("#qualification-keywords").html(qualificationHtml);
                });
                // 채용공고의 id 값을 backend api에 get 방식으로 전달해서 예상 질문 목록을 받는다.
                $.get("/api/question-list?id=" + id, function(data) {
                    // 예상 질문 목록을 modal에 동적으로 생성한다.
                    var html = "";
                    for (var i = 0; i < data.length; i++) {
                        var question = data[i];
                        html += "<tr data-id='" + question.id + "'>";
                        html += "<td>" + question.text + "</td>";
                        html += "<td><button class='icon' data-type='required'>+</button></td>";
                        html += "<td><button class='icon' data-type='optional'>+</button></td>";
                        html += "</tr>";
                    }
                    $("#question-list tbody").html(html);
                });
                // modal을 보여준다.
                $("#job-modal").show();
            });
        }

        // 키워드를 선택하면 채용공고의 상세 정보에서 해당 키워드를 강조하고 예상 질문 목록을 가져오는 함수
        function selectKeyword() {
            // 키워드 값을 가져온다.
            var keyword = $(this).data("keyword");
            // 키워드를 선택한 상태로 표시한다.
            $(this).toggleClass("selected");
            // 채용공고의 상세 정보에서 해당 키워드를 강조한다.
            $("#job-preference, #job-qualification").each(function() {
                var text = $(this).text();
                var regex = new RegExp(keyword, "g");
                if ($(this).find(".selected").length > 0) {
                    // 키워드가 선택된 경우, 색상으로 highlight 한다.
                    text = text.replace(regex, "<span style='color: #7165E3; font-weight: bold;'>" + keyword + "</span>");
                } else {
                    // 키워드가 선택되지 않은 경우, 원래 텍스트로 복원한다.
                    text = text.replace(regex, keyword);
                }
                $(this).html(text);
            });
            // 키워드 값을 backend api에 get 방식으로 전달해서 예상 질문 목록을 받는다.
                        $.get("/api/question-list?keyword=" + keyword, function(data) {
                // 예상 질문 목록을 modal에 동적으로 생성한다.
                var html = "";
                for (var i = 0; i < data.length; i++) {
                    var question = data[i];
                    html += "<tr data-id='" + question.id + "'>";
                    html += "<td>" + question.text + "</td>";
                    html += "<td><button class='icon' data-type='required'>+</button></td>";
                    html += "<td><button class='icon' data-type='optional'>+</button></td>";
                    html += "</tr>";
                }
                $("#question-list tbody").html(html);
            });
        }

        // 예상 질문의 plus icon을 클릭하면 트리구조의 질문을 생성하고 하위 질문 목록을 가져오는 함수
        function addQuestion() {
            // 예상 질문의 id 값을 가져온다.
            var id = $(this).closest("tr").data("id");
            // plus icon의 type 값을 가져온다. (required or optional)
            var type = $(this).data("type");
            // 예상 질문의 text 값을 가져온다.
            var text = $(this).closest("tr").find("td:first").text();
            // 트리구조의 질문을 modal에 동적으로 생성한다.
            var html = "<li><span class='question' data-id='" + id + "' data-type='" + type + "'>" + text + "</span><ul></ul></li>";
            $("#question-tree").append(html);
            // 예상 질문의 id 값을 backend api에 get 방식으로 전달해서 하위 질문 목록을 받는다.
            $.get("/api/subquestion-list?id=" + id, function(data) {
                // 하위 질문 목록을 modal에 동적으로 생성한다.
                var html = "";
                for (var i = 0; i < data.length; i++) {
                    var question = data[i];
                    html += "<tr data-id='" + question.id + "'>";
                    html += "<td>" + question.text + "</td>";
                    html += "<td><input type='checkbox' data-type='required'></td>";
                    html += "<td><input type='checkbox' data-type='optional'></td>";
                    html += "</tr>";
                }
                $("#question-tree li:last-child ul").html(html);
            });
        }

        // 트리구조의 질문을 선택하면 질문 생성 폼을 보여주는 함수
        function selectQuestion() {
            // 트리구조의 질문을 선택한 상태로 표시한다.
            $(this).toggleClass("selected");
            // 질문 생성 폼을 modal에 동적으로 생성한다.
            var html = "";
            html += "<label>질문 종류를 선택하세요.</label>";
            html += "<input type='radio' name='kind' id='kind1' value='1'>";
            html += "<label for='kind1'>경험</label>";
            html += "<input type='radio' name='kind' id='kind2' value='2'>";
            html += "<label for='kind2'>역량</label>";
            html += "<input type='radio' name='kind' id='kind3' value='3'>";
            html += "<label for='kind3'>스킬</label>";
            html += "<label>질문 key를 입력하세요.</label>";
            html += "<input type='text' name='key' id='key' placeholder='예) 페이스북 광고'>";
            html += "<label>필수/선택을 선택하세요.</label>";
            html += "<input type='radio' name='type' id='type1' value='required'>";
            html += "<label for='type1'>필수</label>";
            html += "<input type='radio' name='type' id='type2' value='optional'>";
            html += "<label for='type2'>선택</label>";
            html += "<button class='button' id='add'>추가하기</button>";
            $("#question-form").html(html);
        }

        // 질문 생성 폼에서 추가하기 버튼을 클릭하면 트리구조의 질문을 생성하고 하위 질문 목록을 가져오는 함수
        function createQuestion() {
            // 질문 생성 폼에서 입력한 값을 가져온다.
            var kind = $("input[name='kind']:checked").val();
            var key = $("#key").val();
            var type = $("input[name='type']:checked").val();
            // 입력한 값이 없으면 alert를 띄운다.
            if (!kind || !key || !type) {
                alert("질문 종류, key, 필수/선택을 모두 입력하세요.");
                return;
            }
            // 입력한 값을 backend api에 post 방식으로 전달해서 새로운 질문을 생성한다.
            $.post("/api/question-create", {kind: kind, key: key, type: type}, function(data) {
                // 새로운 질문의 id와 text 값을 받는다.
                var id = data.id;
                var text = data.text;
                // 트리구조의 질문을 modal에 동적으로 생성한다.
                var html = "<li><span class='question' data-id='" + id + "' data-type='" + type + "'>" + text + "</span><ul></ul></li>";
                $("#question-tree li.selected ul").append(html);
                // 새로운 질문의 id 값을 backend api에 get 방식으로 전달해서 하위 질문 목록을 받는다.
                $.get("/api/subquestion-list?id=" + id, function(data) {
                    // 하위 질문 목록을 modal에 동적으로 생성한다.
                    var html = "";
                    for (var i = 0; i < data.length; i++) {
                        var question = data[i];
                        html += "<tr data-id='" + question.id + "'>";
                        html += "<td>" + question.text + "</td>";
                        html += "<td><input type='checkbox' data-type='required'></td>";
                        html += "<td><input type='checkbox' data-type='optional'></td>";
                        html += "</tr>";
                    }
                    $("#question-tree li.selected li:last-child ul").html(html);
                });
            });
        }

        // 저장하기 버튼을 클릭하면 트리구조의 질문을 backend api에 전달하는 함수
        function saveQuestion() {
            // 트리구조의 질문을 배열로 변환한다.
            var questions = [];
            $("#question-tree li span.question").each(function() {
                var id = $(this).data("id");
                var type = $(this).data("type");
                questions.push({id: id, type: type});
            });
            // 채용공고의 id 값을 가져온다.
            var jobId = $("#job-title").data("id");
            // 채용공고의 id 값과 트리구조의 질문 배열을 backend api에 post 방식으로 전달한다.
            $.post("/api/question-save", {jobId: jobId, questions: questions}, function(data) {
                // 성공 메시지를 alert로 띄운다.
                alert(data.message);
                // modal을 닫는다.
                $("#job-modal").hide();
            });
        }

        // 조회 버튼을 클릭하면 getJobList 함수를 호출한다.
        $("#search").click(getJobList);
        // 채용공고를 클릭하면 getJobDetail 함수를 호출한다.
        $("#job-list").on("click", "tr", getJobDetail);
        // 키워드를 클릭하면 selectKeyword 함수를 호출한다.
        $("#job-modal").on("click", ".keyword", selectKeyword);
        // 예상 질문의 plus icon을 클릭하면 addQuestion 함수를 호출한다.
        $("#job-modal").on("click", ".icon", addQuestion);
        // 트리구조의 질문을 클릭하면 selectQuestion 함수를 호출한다.
        $("#job-modal").on("click", ".question", selectQuestion);
        // 질문 생성 폼에서 추가하기 버튼을 클릭하면 createQuestion 함수를 호출한다.
        $("#job-modal").on("click", "#add", createQuestion);
        // 저장하기 버튼을 클릭하면 saveQuestion 함수를 호출한다.
        $("#job-modal").on("click", "#save", saveQuestion);
        // modal 닫기 버튼을 클릭하면 modal을 숨긴다.
        $("#close").click(function() {
            $("#job-modal").hide();
        });
    </script>
</body>
</html>
